<loading [isLoading]="options.loading"></loading>

<div class="table-responsive py-1" *ngIf="!options.loading">
  <table class="table table-hover">
    <thead class="thead-dark">
      <tr>
        <th *ngFor="let item of vm.tableHeadItems[options.type]" [ngClass]="{'pointer': item.order !== null}"
          (click)="onChangeOrder(item.order)">
          {{ item.name }}
        </th>
      </tr>
    </thead>
    <tbody *ngIf="options.items.length > 0">
      <ng-container>
        <!-- Brand -->
        <ng-container *ngIf="options.type === 'brand'">
          <tr class="pointer" *ngFor="let item of options.items">
            <td></td>
            <td [routerLink]="['/brands/one', item._id]">
              {{ item.name }}
            </td>
            <td>{{ item.country }}</td>
            <td>{{ item.continent }}</td>
            <td>{{ item.cars.length }}</td>
            <td>{{ item.updated | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.created | dateToTimeAgo | titlecase }}</td>
          </tr>
        </ng-container>

        <!-- Car -->
        <ng-container *ngIf="options.type === 'car'">
          <tr class="pointer" *ngFor="let item of options.items">
            <td></td>
            <td [routerLink]="['/cars/one', item._id]">
              {{ item.name }}
            </td>
            <td>{{ item.driver.name }}</td>
            <td>{{ item.brand?.name }}</td>
            <td>{{ item.model }}</td>
            <td>{{ item.traction }}</td>
            <td>{{ item.cc }}</td>
            <td>{{ item.cv }}</td>
            <td>{{ item.year }}</td>
            <td>{{ item.inscriptions.length }}</td>
            <td>{{ item.updated | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.created | dateToTimeAgo | titlecase }}</td>
          </tr>
        </ng-container>

        <!-- Inscription -->
        <ng-container *ngIf="options.type === 'inscription'">
          <tr class="pointer" *ngFor="let item of options.items">
            <td></td>
            <td>{{ item.car.name }}</td>
            <td>{{ item.tournament.name }}</td>
            <td>{{ item.updated | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.created | dateToTimeAgo | titlecase }}</td>
          </tr>
        </ng-container>

        <!-- Round -->
        <ng-container *ngIf="options.type === 'round'">
          <tr class="pointer" *ngFor="let item of options.items">
            <td [routerLink]="['/round/one', item._id]">
              {{ item.name }}
            </td>
            <td>{{ item.participants }}</td>
            <td>{{ item.tournament.name }}</td>
            <td>{{ item.startDate | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.endDate | dateToTimeAgo | titlecase}}</td>
            <td>
              <span class="badge" [ngClass]="{
                'bg-danger': item.status === 'Canceled',
                'bg-success': item.status === 'Completed',
                'bg-primary': item.status === 'InProgress',
                'bg-warning': item.status === 'Todo'
              }">
                {{ item.status | status }}
              </span>
            </td>
            <td>{{ item.created | dateToTimeAgo | titlecase }}</td>
          </tr>
        </ng-container>

        <!-- Tournament -->
        <ng-container *ngIf="options.type === 'tournament'">
          <tr class="pointer" *ngFor="let item of options.items">
            <td></td>
            <td [routerLink]="['/tournaments/one', item._id]">
              {{ item.name }}
            </td>
            <td>{{ item.startDate | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.inscriptions?.length }} / {{ item.maxParticipants}}</td>
            <td>{{ item.rounds?.length }}</td>
            <td>{{ item.requisites.length }}</td>
            <td>
              <span class="badge" [ngClass]="{
                'bg-danger': item.status === 'Canceled',
                'bg-success': item.status === 'Completed',
                'bg-primary': item.status === 'InProgress',
                'bg-warning': item.status === 'Todo'
              }">
                {{ item.status | status }}
              </span>
            </td>

            <td>{{ item.updated | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.created | dateToTimeAgo | titlecase }}</td>
          </tr>
        </ng-container>

        <!-- User -->
        <ng-container *ngIf="options.type === 'user'">
          <tr class="pointer" *ngFor="let item of options.items">
            <td [routerLink]="['/users/one', item._id]">
              {{ item.name }}
            </td>
            <td>{{ item.email }}</td>
            <td>{{ item.role }}</td>
            <td>{{ item.cars.length }}</td>
            <td>{{ item.updated | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.created | dateToTimeAgo | titlecase }}</td>
          </tr>
        </ng-container>

        <!-- Vote -->
        <ng-container *ngIf="options.type === 'vote'">
          <tr class="pointer" *ngFor="let item of options.items">
            <td [routerLink]="['/votings/one', item._id]">
              {{ item.type === 'site' ? 'Sitio' : 'Evento' }}
            </td>
            <td [routerLink]="['/votings/one', item._id]">
              <div [innerHTML]="item.value | starsForList"></div>
            </td>
            <td
              [routerLink]="[item.site?._id ? '/sites/one' : '/events/one', item.site?._id ? item.site?._id : item.event?._id]">
              {{ item.site?.name ? item.site?.name : item.event?.name }}
            </td>
            <td>{{ item.updated | dateToTimeAgo | titlecase }}</td>
            <td>{{ item.created | dateToTimeAgo | titlecase }}</td>
          </tr>
        </ng-container>
      </ng-container>

    </tbody>

  </table>
  <div *ngIf="options.items.length === 0" class="alert alert-warning">No hay elementos disponibles</div>
  <div class="text-center mb-3">
    <button class="btn btn-primary w-100" *ngIf="options.showLoadMore && options.items.length > 9"
      (click)="changePage.emit()">
      Cargar mas
    </button>
  </div>
</div>